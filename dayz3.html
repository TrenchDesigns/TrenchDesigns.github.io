<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sebs DayZ Map v2.1</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">

<style>
html,body{
    margin:0;
    height:100%;
    overflow:hidden;
    background:#111;
    color:#fff;
    font-family:'Segoe UI',Roboto,sans-serif;
}

/* NAVBAR */
.navbar-glass{
    backdrop-filter:blur(16px) saturate(180%);
    background:rgba(30,30,30,.6);
    border-bottom:2px solid #88ff00;
    padding:.4rem 1rem;
}
.navbar-brand{color:#88ff00;font-weight:700}

/* VIEWPORT */
#viewport{
    position:relative;
    width:100%;
    height:calc(100vh - 110px);
    overflow:hidden;
    cursor:grab;
    touch-action:none;
}

/* MAP */
#map-wrapper{
    position:absolute;
    width:1500px;
    height:1356px;
    transform-origin:0 0;
    will-change:transform;
}
#map-container{
    width:1500px;
    height:1356px;
    background:url('CHERNOMAP.webp') no-repeat top left;
    background-size:contain;
}

/* MARKERS */
.marker{
    position:absolute;
    width:16px;
    height:16px;
    border-radius:50%;
    transform:translate(-50%,-50%);
    cursor:pointer;
    transition:transform .15s ease,opacity .2s ease;
}
.marker.hidden{opacity:0;pointer-events:none}

/* TOOLTIP */
#tooltip{
    position:fixed;
    background:rgba(0,0,0,.9);
    padding:6px 10px;
    border-radius:10px;
    font-size:12px;
    display:none;
    z-index:2000;
}

/* LEGEND */
#legend{
    position:absolute;
    top:80px;
    left:10px;
    z-index:500;
    display:flex;
    flex-direction:column;
    gap:6px;
}
.legend-badge{
    font-size:.75rem;
    padding:.3em .6em;
    border-radius:.4rem;
}

/* SEARCH */
#searchBox{
    width:180px;
    font-size:.85rem;
}

/* THERMAL */
#thermal-overlay{
    position:absolute;
    top:0;
    left:0;
    width:1500px;
    height:1356px;
    display:none;
    pointer-events:none;
    mix-blend-mode:overlay;
}

/* FOOTER */
footer{
    position:sticky;
    bottom:0;
    width:100%;
    padding:.35rem;
    font-size:.75rem;
    background:rgba(30,30,30,.6);
    border-top:2px solid #88ff00;
    color:#88ff00;
    text-align:center;
}
</style>
</head>

<body>

<nav class="navbar navbar-glass d-flex justify-content-between align-items-center">
    <span class="navbar-brand"><i class="fa-solid fa-map"></i> Sebs DayZ Map</span>
    <div class="d-flex gap-2 align-items-center">
        <input id="searchBox" class="form-control form-control-sm" placeholder="Search locationâ€¦">
        <button class="btn btn-success btn-sm" id="toggle-thermal">
            <i class="fa-solid fa-fire"></i>
        </button>
    </div>
</nav>

<div id="viewport">
    <div id="map-wrapper">
        <div id="map-container"></div>
        <canvas id="thermal-overlay" width="1500" height="1356"></canvas>
    </div>
    <div id="legend"></div>
</div>

<div id="tooltip"></div>
<footer>Designed by Seb, 2026</footer>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<script>
/* ================= DATA ================= */
const locations=[
 {n:'Balota',x:453,y:1188,t:'Village'},
 {n:'Balota Airfield',x:479,y:1197,t:'Airfield'},
 {n:'Chernogorsk',x:621,y:1176,t:'City'},
 {n:'Elektrozavodsk',x:971,y:1224,t:'City'},
 {n:'NWAF',x:418,y:453,t:'Airfield'},
 {n:'Tisy Military Base',x:157,y:139,t:'Military'},
 {n:'Zelenogorsk',x:263,y:934,t:'City'}
];

const colors={
 City:'#1e90ff',
 Town:'#00ffff',
 Village:'#00ff66',
 Military:'#ff3333',
 Airfield:'#ffa500'
};

/* ================= MARKERS ================= */
const map=document.getElementById('map-container');
const tooltip=document.getElementById('tooltip');
const markers=[];

locations.forEach(l=>{
 const m=document.createElement('div');
 m.className='marker';
 m.style.left=l.x+'px';
 m.style.top=l.y+'px';
 m.style.background=colors[l.t];
 m.dataset.name=l.n.toLowerCase();
 m.dataset.type=l.t;

 m.addEventListener('mouseenter',e=>{
   tooltip.style.display='block';
   tooltip.innerHTML=`<strong>${l.n}</strong><br>${l.t}`;
 });
 m.addEventListener('mousemove',e=>{
   tooltip.style.left=e.clientX+12+'px';
   tooltip.style.top=e.clientY+12+'px';
 });
 m.addEventListener('mouseleave',()=>tooltip.style.display='none');

 m.addEventListener('click',()=>{
   zoomTo(l.x,l.y,2.2);
 });

 map.appendChild(m);
 markers.push(m);
});

/* ================= LEGEND ================= */
const legend=document.getElementById('legend');
Object.entries(colors).forEach(([k,v])=>{
 const s=document.createElement('span');
 s.className='badge legend-badge';
 s.style.background=v;
 s.textContent=k;
 legend.appendChild(s);
});

/* ================= PAN / ZOOM CORE ================= */
const wrapper=document.getElementById('map-wrapper');
const viewport=document.getElementById('viewport');

let scale=1;
let originX=0,originY=0;
let dragging=false,startX=0,startY=0;

/* Desktop pan */
viewport.addEventListener('mousedown',e=>{
 dragging=true;
 startX=e.clientX-originX;
 startY=e.clientY-originY;
});
window.addEventListener('mouseup',()=>dragging=false);
window.addEventListener('mousemove',e=>{
 if(!dragging) return;
 originX=e.clientX-startX;
 originY=e.clientY-startY;
 requestUpdate();
});

/* Desktop zoom (cursor-centered) */
viewport.addEventListener('wheel',e=>{
 e.preventDefault();
 const rect=viewport.getBoundingClientRect();
 const cx=e.clientX-rect.left;
 const cy=e.clientY-rect.top;
 const prev=scale;
 scale*=e.deltaY<0?1.1:0.9;
 scale=Math.min(4,Math.max(.6,scale));
 originX-=(cx/prev)*(scale-prev);
 originY-=(cy/prev)*(scale-prev);
 requestUpdate();
},{passive:false});

/* ================= FIXED PINCH ZOOM ================= */
let pinchStartDist=0;
let pinchStartScale=1;
let pinchCenter={x:0,y:0};

viewport.addEventListener('touchstart',e=>{
 if(e.touches.length===1){
   startX=e.touches[0].clientX-originX;
   startY=e.touches[0].clientY-originY;
 }
 if(e.touches.length===2){
   const t1=e.touches[0], t2=e.touches[1];
   pinchStartDist=Math.hypot(t1.clientX-t2.clientX,t1.clientY-t2.clientY);
   pinchStartScale=scale;

   const rect=viewport.getBoundingClientRect();
   pinchCenter.x=((t1.clientX+t2.clientX)/2)-rect.left;
   pinchCenter.y=((t1.clientY+t2.clientY)/2)-rect.top;
 }
},{passive:false});

viewport.addEventListener('touchmove',e=>{
 e.preventDefault();
 if(e.touches.length===1){
   originX=e.touches[0].clientX-startX;
   originY=e.touches[0].clientY-startY;
 }
 if(e.touches.length===2){
   const t1=e.touches[0], t2=e.touches[1];
   const dist=Math.hypot(t1.clientX-t2.clientX,t1.clientY-t2.clientY);
   const newScale=Math.min(4,Math.max(.6,pinchStartScale*(dist/pinchStartDist)));
   const scaleDelta=newScale-scale;

   originX-=(pinchCenter.x/scale)*scaleDelta;
   originY-=(pinchCenter.y/scale)*scaleDelta;

   scale=newScale;
 }
 requestUpdate();
},{passive:false});

/* ================= UTIL ================= */
function clamp(){
 const vw=viewport.clientWidth;
 const vh=viewport.clientHeight;
 const mw=1500*scale;
 const mh=1356*scale;
 originX=Math.min(0,Math.max(vw-mw,originX));
 originY=Math.min(0,Math.max(vh-mh,originY));
}

function requestUpdate(){
 clamp();
 wrapper.style.transform=`translate(${originX}px,${originY}px) scale(${scale})`;
 updateMarkers();
 saveState();
}

function updateMarkers(){
 markers.forEach(m=>{
   if(scale<0.8 && m.dataset.type==='Village')
     m.classList.add('hidden');
   else m.classList.remove('hidden');
   m.style.transform=`translate(-50%,-50%) scale(${1/scale})`;
 });
}

function zoomTo(x,y,z){
 scale=z;
 originX=viewport.clientWidth/2-x*scale;
 originY=viewport.clientHeight/2-y*scale;
 requestUpdate();
}

/* ================= SEARCH ================= */
const search=document.getElementById('searchBox');
search.addEventListener('keydown',e=>{
 if(e.key!=='Enter')return;
 const q=search.value.toLowerCase();
 const l=locations.find(l=>l.n.toLowerCase().includes(q));
 if(l) zoomTo(l.x,l.y,2.5);
});

/* ================= THERMAL ================= */
const canvas=document.getElementById('thermal-overlay');
const ctx=canvas.getContext('2d');
const thermalBtn=document.getElementById('toggle-thermal');
let thermalOn=false;

function drawThermal(){
 ctx.clearRect(0,0,1500,1356);
 locations.forEach(l=>{
   const g=ctx.createRadialGradient(l.x,l.y,0,l.x,l.y,90);
   g.addColorStop(0,'rgba(255,0,0,.35)');
   g.addColorStop(1,'rgba(255,0,0,0)');
   ctx.fillStyle=g;
   ctx.fillRect(l.x-90,l.y-90,180,180);
 });
}

thermalBtn.onclick=()=>{
 thermalOn=!thermalOn;
 canvas.style.display=thermalOn?'block':'none';
 if(thermalOn) drawThermal();
 saveState();
};

/* ================= STATE ================= */
function saveState(){
 localStorage.setItem('mapState',JSON.stringify({scale,originX,originY,thermalOn}));
}
function loadState(){
 const s=JSON.parse(localStorage.getItem('mapState')||'null');
 if(!s) return;
 scale=s.scale; originX=s.originX; originY=s.originY;
 thermalOn=s.thermalOn;
 canvas.style.display=thermalOn?'block':'none';
}

/* ================= INIT ================= */
function centerMap(){
 scale=1;
 originX=(viewport.clientWidth-1500)/2;
 originY=(viewport.clientHeight-1356)/2;
 requestUpdate();
}
window.addEventListener('resize',centerMap);
loadState();
centerMap();
</script>

</body>
</html>
