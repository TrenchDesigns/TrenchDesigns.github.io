<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>DayZ Tactical Companion ‚Äì Tactical Map</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>

<style>
html, body {
  margin:0; height:100%; overflow:hidden;
  font-family:system-ui, monospace; background:#080808; color:#eee;
}
#map { position:absolute; inset:0; background:#111; }
.navbar { z-index:1000; background:#111 !important; border-bottom:1px solid #333; }
.navbar .navbar-brand { color:#ff5555; font-weight:bold; }
.panel {
  position:absolute; background:rgba(10,10,10,0.9);
  color:#ddd; border:1px solid #333; padding:10px 14px;
  border-radius:6px; font-size:14px; z-index:500; text-shadow:0 0 4px #000;
}
#info {top:70px; right:12px; max-width:280px;}
#tip {bottom:10px; left:50%; transform:translateX(-50%); min-width:260px; text-align:center;}
#legend {bottom:10px; left:10px; background:rgba(20,20,20,0.9); padding:8px 12px; border-radius:6px; font-size:13px;}
.leaflet-control-layers-expanded {
  background:rgba(20,20,20,0.95); color:#eee; border:1px solid #444;
}
.leaflet-control-layers-selector { accent-color:#ff4444; }
</style>
</head>
<body>

<nav class="navbar navbar-dark px-3">
  <span class="navbar-brand">üß≠ DayZ Tactical Companion</span>
  <div class="ms-auto d-flex gap-2">
    <button id="toggleThermal" class="btn btn-sm btn-outline-danger">Thermal Vision</button>
    <button id="toggleSpawnTool" class="btn btn-sm btn-outline-warning">Place Marker</button>
  </div>
</nav>

<div id="map"></div>

<div id="info" class="panel">Hover a military location for details</div>
<div id="tip" class="panel">Survival Tip: Stay sharp!</div>
<div id="legend" class="panel">
  <strong>Legend</strong><br>
  üõ°Ô∏è Military Zones<br>
  üî∂ Explorer Players<br>
  üîµ Cautious Survivors<br>
  üî¥ Aggressive Players<br>
  üü† Custom Marker<br>
  üî• Heat = Player activity
</div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script src="https://cdn.jsdelivr.net/npm/leaflet.heat/dist/leaflet-heat.js"></script>

<script>
// --- MAP SETUP ---
const MAP_W=1500, MAP_H=1450;
const map=L.map('map',{crs:L.CRS.Simple,minZoom:-2,maxZoom:6});
L.imageOverlay('chernarus.png',[[0,0],[MAP_H,MAP_W]]).addTo(map);
map.fitBounds([[0,0],[MAP_H,MAP_W]]);
const px=(x,y)=>[y,x];

// --- LAYERS ---
const militaryLayer=L.layerGroup().addTo(map);
const playerLayer   =L.layerGroup().addTo(map);
const heatLayer     =L.heatLayer([], {radius:80, blur:45, max:3});
const customMarkerLayer=L.layerGroup().addTo(map);

L.control.layers(null,{
  "Military Zones": militaryLayer,
  "Players": playerLayer,
  "Heatmap": heatLayer,
  "Custom Markers": customMarkerLayer
},{collapsed:false,position:'topright'}).addTo(map);

// --- ICON HELPERS ---
function svgToDataUrl(svg){return "data:image/svg+xml;base64,"+btoa(svg);}

// Military icon (larger)
const militaryIconBaseSize=32;
const militarySvg=`<svg xmlns="http://www.w3.org/2000/svg" width="${militaryIconBaseSize}" height="${militaryIconBaseSize}">
  <path d="M16 0l16 6.4v12.8c0 16-11.2 24-16 24s-16-8-16-24V6.4L16 0z"
    fill="#ff4444" stroke="#000" stroke-width="2"/>
  <circle cx="16" cy="10" r="6" fill="#fff"/>
</svg>`;
function createMilitaryIcon(size){
  return L.icon({
    iconUrl: svgToDataUrl(militarySvg),
    iconSize:[size,size],
    iconAnchor:[size/2,size],
    popupAnchor:[0,-size*0.7]
  });
}

// Player icons per archetype
const playerIcons={
  EXPLORER: L.icon({
    iconUrl: svgToDataUrl(`<svg xmlns="http://www.w3.org/2000/svg" width="22" height="22">
      <circle cx="11" cy="11" r="10" fill="#ffcc00" stroke="#000" stroke-width="2"/>
    </svg>`),
    iconSize:[22,22], iconAnchor:[11,22], popupAnchor:[0,-18]
  }),
  CAUTIOUS: L.icon({
    iconUrl: svgToDataUrl(`<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18">
      <circle cx="9" cy="9" r="8" fill="#3399ff" stroke="#000" stroke-width="2"/>
    </svg>`),
    iconSize:[18,18], iconAnchor:[9,18], popupAnchor:[0,-14]
  }),
  AGGRESSIVE: L.icon({
    iconUrl: svgToDataUrl(`<svg xmlns="http://www.w3.org/2000/svg" width="26" height="26">
      <circle cx="13" cy="13" r="12" fill="#ff4444" stroke="#000" stroke-width="2"/>
    </svg>`),
    iconSize:[26,26], iconAnchor:[13,26], popupAnchor:[0,-18]
  })
};

function chooseArchetype(){
  const r=Math.random();
  return r<0.4?"EXPLORER":(r<0.75?"CAUTIOUS":"AGGRESSIVE");
}

const customMarkerIcon=L.icon({
  iconUrl: svgToDataUrl(`<svg xmlns="http://www.w3.org/2000/svg" width="28" height="28">
    <path fill="#ff8800" d="M14 2C9 2 5 6 5 10c0 6 9 15 9 15s9-9 9-15c0-4-4-8-9-8z"/>
  </svg>`),
  iconSize:[28,28], iconAnchor:[14,28], popupAnchor:[0,-20]
});

// --- MILITARY DATA ---
const MILITARY=[
  {x:214,y:454,name:"Zelenogorsk"},
  {x:410,y:148,name:"Balota"},
  {x:152,y:260,name:"Pavlovo"},
  {x:566,y:734,name:"Stary"},
  {x:784,y:1388,name:"Kamensk"},
  {x:1120,y:1280,name:"NEAF"},
  {x:264,y:1376,name:"Tisy"},
  {x:372,y:1004,name:"NWAF"},
  {x:342,y:762,name:"VMC"}
];
const risk={}, markers={};
MILITARY.forEach(m=>{
  risk[m.name]=0;
  const mk=L.marker(px(m.x,m.y),{icon:createMilitaryIcon(militaryIconBaseSize)}).addTo(militaryLayer);
  markers[m.name]=mk;
  mk.on("mouseover",()=>info.innerHTML=`<strong>${m.name}</strong><br>Risk: ${risk[m.name].toFixed(1)}`);
  mk.on("mouseout",()=>info.innerText="Hover a military location for details");
});

// --- AGENT LOGIC & MOVEMENT ---
const players=[];
let playerCount=0;

function weightedRandomSpawn(){
  const zones=[
    {x:850,y:250,weight:0.18},{x:600,y:400,weight:0.14},
    {x:1120,y:1280,weight:0.08},{x:214,y:454,weight:0.08},
    {x:410,y:148,weight:0.07},{x:784,y:1388,weight:0.06},
    {x:264,y:1376,weight:0.06},{x:372,y:1004,weight:0.15},
    {x:342,y:762,weight:0.10},{x:400,y:700,weight:0.05},
    {x:750,y:750,weight:0.05},{x:MAP_W/2,y:MAP_H/2,weight:0.05}
  ];
  let total=0; zones.forEach(z=>total+=z.weight);
  let r=Math.random()*total;
  for(let z of zones){ if(r<z.weight) return {x:z.x+(Math.random()*150-75),y:z.y+(Math.random()*150-75)}; r-=z.weight; }
  return {x:Math.random()*MAP_W,y:Math.random()*MAP_H};
}

function generateWaypoints(target){
  const start=weightedRandomSpawn(), pts=[start];
  const segments=2+Math.floor(Math.random()*4);
  for(let i=1;i<segments;i++){
    const frac=i/segments, ang=Math.random()*Math.PI*2;
    pts.push({
      x:start.x+(target.x-start.x)*frac+Math.cos(ang)*120*Math.random(),
      y:start.y+(target.y-start.y)*frac+Math.sin(ang)*120*Math.random()
    });
  }
  pts.push(target); return pts;
}

function spawnPlayer(isGroup=false){
  const kind=chooseArchetype();
  const target=MILITARY[Math.floor(Math.random()*MILITARY.length)];
  const waypoints=generateWaypoints(target);
  const size=isGroup?2+Math.floor(Math.random()*3):1;
  for(let i=0;i<size;i++){
    const jitter={x:Math.random()*6-3,y:Math.random()*6-3,phase:Math.random()*Math.PI*2};
    const start=waypoints[0];
    const dot=L.marker(px(start.x+jitter.x,start.y+jitter.y),{icon:playerIcons[kind]}).addTo(playerLayer)
      .bindPopup(`Player ${++playerCount} (${kind})`);
    const speed=0.0006+Math.random()*0.0012;
    players.push({dot,waypoints,seg:0,step:0,jitter,speed,alive:true});
  }
}

function movePlayers(){
  players.forEach(p=>{
    if(!p.alive) return;
    if(p.seg>=p.waypoints.length-1)return;
    const from=p.waypoints[p.seg], to=p.waypoints[p.seg+1];
    const x=from.x+(to.x-from.x)*p.step+Math.sin(p.jitter.phase)*p.jitter.x;
    const y=from.y+(to.y-from.y)*p.step+Math.cos(p.jitter.phase)*p.jitter.y;
    p.dot.setLatLng(px(x,y));
    heatLayer.addLatLng([y,x,0.25]);
    MILITARY.forEach(m=>{ if(Math.hypot(m.x-x,m.y-y)<220) risk[m.name]+=0.015; });
    p.step+=p.speed; p.jitter.phase+=0.03;
    if(p.step>=1){p.step=0; p.seg++;}
  });
  requestAnimationFrame(movePlayers);
}

for(let i=0;i<25;i++) spawnPlayer(Math.random()<0.35);
requestAnimationFrame(movePlayers);

// risk decay
setInterval(()=>{
  Object.keys(risk).forEach(k=>{ risk[k]=Math.max(0,risk[k]-0.02);
    markers[k].setIcon(createMilitaryIcon(32+Math.floor(risk[k]*10)); });
  });
},3000);

// survival tips
const tips=[
  "Avoid running in open fields.","Check rooftops for ambushes.","Use terrain wisely."
];
setInterval(()=>{ tip.innerText="Tip: "+tips[Math.floor(Math.random()*tips.length)]; },10000);

// toggles
let thermal=false, markerTool=false;
toggleThermal.onclick=()=>{thermal=!thermal; thermal?heatLayer.addTo(map):map.removeLayer(heatLayer);};
toggleSpawnTool.onclick=()=>{markerTool=!markerTool;};
map.on("click",e=>{ if(!markerTool)return;
  L.marker([e.latlng.lat,e.latlng.lng],{icon:customMarkerIcon}).addTo(customMarkerLayer)
   .bindPopup(`Custom: ${e.latlng.lng.toFixed(1)}, ${e.latlng.lat.toFixed(1)}`);
});
</script>
</body>
</html>
