<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>DayZ Tactical Companion â€“ Live Map</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>

<style>
html, body {
  margin:0; height:100%; overflow:hidden;
  font-family:system-ui, monospace; background:#080808; color:#eee;
}
#map { position:absolute; inset:0; background:#111; }
.navbar { z-index:1000; background:#111 !important; border-bottom:1px solid #333; }
.navbar .navbar-brand { color:#ff5555; font-weight:bold; }

/* Legend Box */
#legend {
  position:fixed;
  bottom:10px;
  left:10px;
  background:rgba(20,20,20,0.9);
  padding:12px;
  border-radius:6px;
  font-size:14px;
  color:#eee;
  z-index:9999;
}
.legend-item {
  display:flex; align-items:center; margin-bottom:6px;
}
.legend-item img {
  width:18px; height:18px; margin-right:8px;
}

.panel {
  position:absolute; background:rgba(10,10,10,0.9);
  color:#ddd; border:1px solid #333; padding:10px 14px;
  border-radius:6px; font-size:14px; z-index:500; text-shadow:0 0 4px #000;
}
#info {top:70px; right:12px; max-width:280px;}
#tip {bottom:10px; left:50%; transform:translateX(-50%); min-width:260px; text-align:center;}

.leaflet-control-layers-expanded {
  background:rgba(20,20,20,0.95); color:#eee; border:1px solid #444;
}
.leaflet-control-layers-selector { accent-color:#ff4444; }
</style>
</head>
<body>

<nav class="navbar navbar-dark px-3">
  <span class="navbar-brand">ðŸ§­ DayZ Tactical Companion</span>
  <div class="ms-auto d-flex gap-2">
    <button id="toggleThermal" class="btn btn-sm btn-outline-danger">Thermal Vision</button>
    <button id="toggleSpawnTool" class="btn btn-sm btn-outline-warning">Place Marker</button>
  </div>
</nav>

<div id="map"></div>

<!-- LEGEND -->
<div id="legend">
  <strong>Legend</strong><br><br>
  <div class="legend-item"><img id="legend-military" src=""> Military Zone</div>
  <div class="legend-item"><img id="legend-explorer" src=""> Explorer Player</div>
  <div class="legend-item"><img id="legend-cautious" src=""> Cautious Survivor</div>
  <div class="legend-item"><img id="legend-aggressive" src=""> Aggressive Player</div>
  <div class="legend-item"><img id="legend-custom" src=""> Custom Marker</div>
  <div style="margin-top:8px; font-size:12px;">ðŸ”¥ Heat = Player activity</div>
</div>

<div id="info" class="panel">Hover a military location for details</div>
<div id="tip" class="panel">Survival Tip: Stay alert!</div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script src="https://cdn.jsdelivr.net/npm/leaflet.heat/dist/leaflet-heat.js"></script>

<script>
// ===== ICON HELPERS =====
function svgToDataUrl(svg) {
  return "data:image/svg+xml;base64," + btoa(svg);
}

// SVG strings
const svgIcons = {
  military: `<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32">
    <path d="M16 0l16 6v16c0 16-11 24-16 24s-16-8-16-24V6L16 0z"
      fill="#ff4444" stroke="#000" stroke-width="2"/>
    <circle cx="16" cy="10" r="6" fill="#fff"/>
  </svg>`,

  explorer: `<svg xmlns="http://www.w3.org/2000/svg" width="22" height="22">
    <circle cx="11" cy="11" r="10" fill="#ffcc00" stroke="#000" stroke-width="2"/>
  </svg>`,

  cautious: `<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18">
    <circle cx="9" cy="9" r="8" fill="#3399ff" stroke="#000" stroke-width="2"/>
  </svg>`,

  aggressive: `<svg xmlns="http://www.w3.org/2000/svg" width="26" height="26">
    <circle cx="13" cy="13" r="12" fill="#ff4444" stroke="#000" stroke-width="2"/>
  </svg>`,

  custom: `<svg xmlns="http://www.w3.org/2000/svg" width="28" height="28">
    <path fill="#ff8800" d="M14 2C9 2 5 6 5 10c0 6 9 15 9 15s9-9 9-15c0-4-4-8-9-8z"/>
  </svg>`
};

// fill legend images
document.getElementById("legend-military").src = svgToDataUrl(svgIcons.military);
document.getElementById("legend-explorer").src = svgToDataUrl(svgIcons.explorer);
document.getElementById("legend-cautious").src = svgToDataUrl(svgIcons.cautious);
document.getElementById("legend-aggressive").src = svgToDataUrl(svgIcons.aggressive);
document.getElementById("legend-custom").src = svgToDataUrl(svgIcons.custom);

// ===== MAP SETUP =====
const MAP_W=1500, MAP_H=1450;
const map=L.map('map',{crs:L.CRS.Simple,minZoom:-2,maxZoom:6});
L.imageOverlay('chernarus.png',[[0,0],[MAP_H,MAP_W]]).addTo(map);
map.fitBounds([[0,0],[MAP_H,MAP_W]]);
const px=(x,y)=>[y,x];

// ===== LAYERS =====
const militaryLayer=L.layerGroup().addTo(map);
const playerLayer   =L.layerGroup().addTo(map);
const heatLayer     =L.heatLayer([], {radius:80, blur:45, max:3});
const customMarkerLayer=L.layerGroup().addTo(map);

L.control.layers(null,{
  "Military Zones": militaryLayer,
  "Player Agents": playerLayer,
  "Heatmap": heatLayer,
  "Custom Markers": customMarkerLayer
},{collapsed:false,position:'topright'}).addTo(map);

// ===== MAP ICONS =====
const icons = {
  military: L.icon({
    iconUrl: svgToDataUrl(svgIcons.military),
    iconSize:[32,32],
    iconAnchor:[16,32],
    popupAnchor:[0,-24]
  }),
  explorer: L.icon({
    iconUrl: svgToDataUrl(svgIcons.explorer),
    iconSize:[22,22],
    iconAnchor:[11,22],
    popupAnchor:[0,-18]
  }),
  cautious: L.icon({
    iconUrl: svgToDataUrl(svgIcons.cautious),
    iconSize:[18,18],
    iconAnchor:[9,18],
    popupAnchor:[0,-14]
  }),
  aggressive: L.icon({
    iconUrl: svgToDataUrl(svgIcons.aggressive),
    iconSize:[26,26],
    iconAnchor:[13,26],
    popupAnchor:[0,-18]
  }),
  custom: L.icon({
    iconUrl: svgToDataUrl(svgIcons.custom),
    iconSize:[28,28],
    iconAnchor:[14,28],
    popupAnchor:[0,-20]
  })
};

// ===== MILITARY DATA =====
const MILITARY=[
  {x:214,y:454,name:"Zelenogorsk"},
  {x:410,y:148,name:"Balota"},
  {x:152,y:260,name:"Pavlovo"},
  {x:566,y:734,name:"Stary"},
  {x:784,y:1388,name:"Kamensk"},
  {x:1120,y:1280,name:"NEAF"},
  {x:264,y:1376,name:"Tisy"},
  {x:372,y:1004,name:"NWAF"},
  {x:342,y:762,name:"VMC"}
];
const risk={}, markers={};
MILITARY.forEach(m=>{
  risk[m.name]=0;
  const mk=L.marker(px(m.x,m.y), {icon:icons.military}).addTo(militaryLayer);
  markers[m.name]=mk;
  mk.on("mouseover",()=>info.innerHTML=`<strong>${m.name}</strong><br>Risk: ${risk[m.name].toFixed(1)}`);
  mk.on("mouseout",()=>info.innerText="Hover a military location for details");
});

// ===== PLAYER LOGIC =====
const players=[]; let playerCount=0;

function chooseArchetype(){const r=Math.random();return r<0.4?"explorer":(r<0.75?"cautious":"aggressive");}
function randomSpawn(){return {x:Math.random()*MAP_W,y:Math.random()*MAP_H};}
function genWaypoints(target){
  const start=randomSpawn(), pts=[start];
  const segs=2+Math.floor(Math.random()*3);
  for(let i=1;i<segs;i++){
    const frac=i/segs, ang=Math.random()*Math.PI*2;
    pts.push({
      x:start.x+(target.x-start.x)*frac+Math.cos(ang)*100*Math.random(),
      y:start.y+(target.y-start.y)*frac+Math.sin(ang)*100*Math.random()
    });
  }
  pts.push(target); return pts;
}
function spawnPlayer(isGroup=false){
  const type=chooseArchetype();
  const target=MILITARY[Math.floor(Math.random()*MILITARY.length)];
  const waypoints=genWaypoints(target);
  const count=isGroup?2+Math.floor(Math.random()*3):1;
  for(let i=0;i<count;i++){
    const jitter={x:Math.random()*6-3,y:Math.random()*6-3,phase:Math.random()*Math.PI*2};
    const start=waypoints[0];
    const dot=L.marker(px(start.x+jitter.x,start.y+jitter.y),{icon:icons[type]}).addTo(playerLayer)
      .bindPopup(`Player ${++playerCount} (${type})`);
    const speed=0.0006+Math.random()*0.0012;
    players.push({dot,waypoints,seg:0,step:0,jitter,speed,alive:true});
  }
}
function movePlayers(){
  players.forEach(p=>{
    if(!p.alive)return;
    if(p.seg>=p.waypoints.length-1)return;
    const f=p.waypoints[p.seg], t=p.waypoints[p.seg+1];
    const x=f.x+(t.x-f.x)*p.step+Math.sin(p.jitter.phase)*p.jitter.x;
    const y=f.y+(t.y-f.y)*p.step+Math.cos(p.jitter.phase)*p.jitter.y;
    p.dot.setLatLng(px(x,y)); heatLayer.addLatLng([y,x,0.25]);
    p.step+=p.speed; p.jitter.phase+=0.03; if(p.step>=1){p.step=0; p.seg++;}
  });
  requestAnimationFrame(movePlayers);
}
for(let i=0;i<25;i++) spawnPlayer(Math.random()<0.35);
requestAnimationFrame(movePlayers);

// === SURVIVAL TIPS ===
const tips=["Stay hydrated.","Use terrain wisely.","Avoid open fields."];
setInterval(()=>{tip.innerText="Tip: "+tips[Math.floor(Math.random()*tips.length)];},10000);

// toggles
let thermal=false, markerTool=false;
toggleThermal.onclick=()=>{thermal=!thermal; thermal?heatLayer.addTo(map):map.removeLayer(heatLayer);};
toggleSpawnTool.onclick=()=>{markerTool=!markerTool;};
map.on("click",(e)=>{if(!markerTool)return;
  L.marker([e.latlng.lat,e.latlng.lng],{icon:icons.custom}).addTo(customMarkerLayer)
   .bindPopup(`Custom: ${e.latlng.lng.toFixed(1)}, ${e.latlng.lat.toFixed(1)}`);
});
</script>
</body>
</html>
