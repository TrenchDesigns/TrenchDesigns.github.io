<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>DayZ Chernarus Hub - Immersive</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<style>
html,body{margin:0;padding:0;height:100%;background:#111;overflow:hidden;}
#map-container{position:relative;width:100%;height:100%;filter:brightness(0.35) contrast(1.2);}
#map{position:absolute;inset:0;z-index:10;}
.navbar .btn{display:flex;align-items:center;gap:4px;transition:0.15s;}
.navbar .btn:hover{box-shadow:0 0 12px #ff5555;}
.btn-active{box-shadow:0 0 15px #ff4500!important;}
.panel{
  position:absolute;
  background:rgba(0,0,0,0.6);
  color:#7CFC00;
  padding:0.7rem 0.9rem;
  border-radius:8px;
  z-index:20;
  font-family:monospace;
  font-size:0.9rem;
  text-shadow:0 0 3px #000;
}
#lore{top:70px;right:10px;max-width:260px;}
#tip{bottom:10px;left:50%;transform:translateX(-50%);min-width:220px;text-align:center;}
.marker-military{
  width:18px;height:18px;
  background:red;
  border:2px solid #fff;
  border-radius:50%;
  box-shadow:0 0 10px #ff0000,0 0 20px rgba(255,0,0,0.4);
  animation: pulse 2s infinite;
}
@keyframes pulse{
  0%{box-shadow:0 0 10px #ff0000,0 0 20px rgba(255,0,0,0.4);}
  50%{box-shadow:0 0 20px #ff0000,0 0 40px rgba(255,0,0,0.6);}
  100%{box-shadow:0 0 10px #ff0000,0 0 20px rgba(255,0,0,0.4);}
}
.fog-overlay{
  pointer-events:none;
  position:absolute;
  inset:0;
  background: radial-gradient(circle at 50% 50%, rgba(255,255,255,0.03), rgba(0,0,0,0.6));
  z-index:15;
  animation: fogMove 60s linear infinite;
}
@keyframes fogMove{
  0%{background-position:0 0;}
  100%{background-position:1000px 1000px;}
}
</style>
</head>

<body>

<nav class="navbar navbar-dark bg-dark">
  <div class="container-fluid">
    <span class="navbar-brand"><i class="fa-solid fa-skull-crossbones me-2"></i>DayZ Chernarus Hub</span>
    <div class="d-flex gap-2">
      <button id="addPin" class="btn btn-danger btn-sm"><i class="fa-solid fa-map-pin"></i> Pin</button>
      <button id="addRoute" class="btn btn-secondary btn-sm"><i class="fa-solid fa-route"></i> Route</button>
      <button id="toggleHeat" class="btn btn-warning btn-sm"><i class="fa-solid fa-fire"></i> Thermal</button>
      <button id="toggleNight" class="btn btn-secondary btn-sm"><i class="fa-solid fa-moon"></i> Night</button>
      <button id="clearAll" class="btn btn-secondary btn-sm"><i class="fa-solid fa-trash"></i> Clear</button>
    </div>
  </div>
</nav>

<div id="map-container">
  <div id="map"></div>
  <div class="fog-overlay"></div>
</div>

<div id="lore" class="panel">Hover a military site</div>
<div id="tip" class="panel">Survival Tip: Coastal towns are looted fast!</div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script src="https://cdn.jsdelivr.net/npm/leaflet.heat/dist/leaflet-heat.js"></script>

<script>
// --- MAP ---
const MAP_W=1500, MAP_H=1450;
const map=L.map('map',{crs:L.CRS.Simple,minZoom:-2,maxZoom:6,doubleClickZoom:false});
const bounds=[[0,0],[MAP_H,MAP_W]];
L.imageOverlay('chernarus.png',bounds).addTo(map);
map.fitBounds(bounds);
const px=(x,y)=>[y,x];

// --- MILITARY MARKERS ---
const military=[
  {x:214,y:454,name:"ZELENEGORSK MILITARY"},
  {x:410,y:148,name:"BALOTA MILITARY"},
  {x:152,y:260,name:"PAVLOVO MILITARY"},
  {x:370,y:754,name:"VMC MILITARY"},
  {x:784,y:1388,name:"KAMENSK MILITARY"},
  {x:1120,y:1280,name:"NEAF MILITARY"},
  {x:566,y:734,name:"STARY MILITARY"},
  {x:264,y:1376,name:"TISY MILITARY"}
];
military.forEach(m=>{
  const mk=L.marker(px(m.x,m.y),{icon:L.divIcon({className:"marker-military"})}).addTo(map);
  mk.on("mouseover",()=>lore.innerText=m.name);
  mk.on("mouseout",()=>lore.innerText="Hover a military site");
});

// --- USER MARKERS ---
let pins=JSON.parse(localStorage.getItem("dzPins")||"[]");
pins.forEach(p=>L.marker(px(p.x,p.y)).addTo(map).bindPopup(p.name));

let routes=JSON.parse(localStorage.getItem("dzRoutes")||"[]");
routes.forEach(r=>L.polyline(r.points.map(pt=>px(pt.x,pt.y)),{color:"orange",weight:3}).addTo(map));

let addingPin=false, addingRoute=false, tempRoute=[], tempLine=null;

// --- HEATMAP ---
const heat=L.heatLayer(military.map(m=>[m.y,m.x,1]),{
  radius:150,blur:80,max:1,
  gradient:{0:'rgba(0,0,0,0)',0.2:'rgba(0,0,255,0.5)',0.4:'rgba(0,255,0,0.6)',0.6:'rgba(255,255,0,0.7)',0.8:'rgba(255,0,0,0.9)',1:'rgba(255,0,0,1)'}
});
let heatOn=false;

// --- BUTTONS ---
addPin.onclick=()=>{addingPin=true;addingRoute=false;addPin.classList.add('btn-active');addRoute.classList.remove('btn-active');};
addRoute.onclick=()=>{addingRoute=true;addingPin=false;tempRoute=[];addRoute.classList.add('btn-active');addPin.classList.remove('btn-active');};
clearAll.onclick=()=>{if(confirm("Clear all pins/routes?")){localStorage.clear();location.reload();}};
toggleHeat.onclick=()=>{heatOn=!heatOn;heatOn?heat.addTo(map):map.removeLayer(heat);toggleHeat.classList.toggle('btn-active');};
toggleNight.onclick=()=>{document.getElementById("map-container").style.filter=toggleNight.classList.toggle('btn-active')?"brightness(0.15) contrast(1.7) grayscale(0.3)":"brightness(0.35) contrast(1.2)";};

// --- MAP CLICK ---
map.on("click",e=>{
  const pt={x:e.latlng.lng,y:e.latlng.lat};
  if(addingPin){
    const n=prompt("Pin name"); if(!n) return;
    pins.push({...pt,name:n});
    localStorage.setItem("dzPins",JSON.stringify(pins));
    L.marker(px(pt.x,pt.y)).addTo(map).bindPopup(n);
    return;
  }
  if(addingRoute){
    tempRoute.push(pt);
    if(tempLine)map.removeLayer(tempLine);
    tempLine=L.polyline(tempRoute.map(p=>px(p.x,p.y)),{color:"orange",weight:3,opacity:0.9,dashArray:'6,4'}).addTo(map);
  }
});

map.on("dblclick",e=>{
  if(addingRoute && tempRoute.length>1){
    routes.push({points:tempRoute});
    localStorage.setItem("dzRoutes",JSON.stringify(routes));
    addingRoute=false;tempRoute=[];tempLine=null;
    alert("Route saved!");
    addRoute.classList.remove('btn-active');
  }
});

// --- SURVIVAL TIPS ---
const tips=[
  "Stay hydrated; water is life.",
  "Avoid high zombie populations at night.",
  "Cities have the best loot but highest risk.",
  "Military areas like airfields are worth the danger."
];
setInterval(()=>{tip.innerText="Survival Tip: "+tips[Math.floor(Math.random()*tips.length)];},12000);

</script>
</body>
</html>
