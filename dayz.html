<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>DayZ Chernarus Hub</title>

<!-- Bootstrap CSS -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<!-- Leaflet CSS -->
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
<!-- Font Awesome -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<style>
html,body{margin:0;padding:0;height:100%;background:#111;overflow:hidden;}
#map-container{position:relative;width:100%;height:100%;}
#blur-bg{position:absolute;inset:0;background:url('chernarus.png') center/cover no-repeat;filter:blur(25px) brightness(0.35) contrast(1.2);transform:scale(1.1);z-index:0;}
#map{position:absolute;inset:0;z-index:10;}
nav.navbar{position:fixed;top:0;width:100%;z-index:9999;}
#lore,#tip,#loot-panel{position:absolute;background:rgba(0,0,0,0.75);color:#fff;padding:0.8rem;border-radius:8px;z-index:20;}
#lore{top:70px;right:10px;max-width:300px;}
#tip{bottom:10px;left:50%;transform:translateX(-50%);}
#loot-panel{top:70px;left:10px;max-width:220px;max-height:70vh;overflow-y:auto;}
.marker-military{background:red;width:16px;height:16px;border-radius:50%;border:2px solid #fff;display:block;}
.marker-town{background:green;width:14px;height:14px;border-radius:50%;border:2px solid #fff;display:block;}
.leaflet-container{background:transparent !important;}
</style>
</head>
<body>

<!-- Navbar -->
<nav class="navbar navbar-dark bg-dark">
  <div class="container-fluid">
    <span class="navbar-brand mb-0 h1"><i class="fa-solid fa-skull-crossbones me-2"></i>DayZ Chernarus Hub</span>
    <div class="d-flex gap-2">
      <button id="addPin" class="btn btn-danger btn-sm"><i class="fa-solid fa-map-pin"></i> Pin</button>
      <button id="addRoute" class="btn btn-secondary btn-sm"><i class="fa-solid fa-route"></i> Route</button>
      <button id="clearAll" class="btn btn-secondary btn-sm"><i class="fa-solid fa-trash"></i> Clear</button>
      <button id="toggleNight" class="btn btn-secondary btn-sm"><i class="fa-solid fa-moon"></i> Night</button>
      <button id="toggleHeat" class="btn btn-warning btn-sm"><i class="fa-solid fa-fire"></i> Traffic</button>
    </div>
  </div>
</nav>

<!-- Map container -->
<div id="map-container">
  <div id="blur-bg"></div>
  <div id="map"></div>
</div>

<!-- Panels -->
<div id="lore">Hover over a base for info...</div>
<div id="tip">Survival Tip: Coastal towns are looted fast!</div>
<div id="loot-panel">
  <strong>Loot Filters:</strong><br>
  <input type="checkbox" id="showMilitary" checked> Military <i class="fa-solid fa-crosshairs text-danger"></i><br>
</div>

<!-- JS Libraries -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script src="https://cdn.jsdelivr.net/npm/leaflet.heat/dist/leaflet-heat.js"></script>

<script>
// --- Map Setup ---
const mapWidth=1500,mapHeight=1450;
const map=L.map('map',{crs:L.CRS.Simple,minZoom:-2,maxZoom:6});
const bounds=[[0,0],[mapHeight,mapWidth]];
L.imageOverlay('chernarus.png',bounds).addTo(map);
map.fitBounds(bounds);

// --- Pixel helper ---
function pixelToLeaflet(x,y){return [y,x];}

// --- Markers ---
const militaryBases=[
  {x:203,y:1000,name:"Zelenogorsk",lore:"Top military loot, high risk."},
  {x:380,y:440,name:"NWAF",lore:"North West Airfield, epic loot, very dangerous."}
];
const lootMarkers=[];
militaryBases.forEach(m=>{
  const marker=L.marker(pixelToLeaflet(m.x,m.y),{icon:L.divIcon({className:"marker-military"})}).addTo(map);
  marker.on('mouseover',()=>document.getElementById('lore').innerText=m.name+": "+m.lore);
  marker.on('mouseout',()=>document.getElementById('lore').innerText="Hover over a base for info...");
  lootMarkers.push(marker);
});

// --- Pins & Routes ---
let pins=JSON.parse(localStorage.getItem('dzPins')||'[]');
let routes=JSON.parse(localStorage.getItem('dzRoutes')||'[]');
let addingPin=false,addingRoute=false,tempRoute=[];
function renderPins(){pins.forEach(p=>L.marker(pixelToLeaflet(p.x,p.y)).addTo(map).bindPopup(p.name));}
function renderRoutes(){routes.forEach(r=>L.polyline(r.points.map(pt=>pixelToLeaflet(pt.x,pt.y)),{color:"orange",weight:3}).addTo(map));}
renderPins(); renderRoutes();

document.getElementById('addPin').onclick=()=>{addingPin=!addingPin;addingRoute=false;alert("Click map to add pin");};
document.getElementById('addRoute').onclick=()=>{addingRoute=!addingRoute;addingPin=false;tempRoute=[];alert("Click points, double-click to finish route");};
document.getElementById('clearAll').onclick=()=>{if(confirm("Clear all pins/routes?")){pins=[];routes=[];localStorage.clear();location.reload();}};

map.on('click',e=>{
  const px={x:e.latlng.lng,y:e.latlng.lat};
  if(addingPin){const n=prompt("Pin name:");if(n){pins.push({...px,name:n});localStorage.setItem('dzPins',JSON.stringify(pins));L.marker([px.y,px.x]).addTo(map).bindPopup(n);}}
  if(addingRoute){tempRoute.push(px);if(tempRoute.length>1)L.polyline(tempRoute.map(pt=>[pt.y,pt.x]),{color:"orange",weight:3}).addTo(map);}
});
map.on('dblclick',e=>{if(addingRoute&&tempRoute.length>1){routes.push({points:tempRoute});localStorage.setItem('dzRoutes',JSON.stringify(routes));tempRoute=[];addingRoute=false;alert("Route saved!");}});

// --- Night Mode ---
let night=false;
document.getElementById('toggleNight').onclick=()=>{night=!night;document.getElementById('map-container').style.filter=night?"brightness(0.3) contrast(1.6)":"none";};

// --- Heatmap ---
const trafficPoints=[{x:203,y:1000,intensity:1},{x:380,y:440,intensity:1}];
const heatLayer=L.heatLayer(trafficPoints.map(p=>[p.y,p.x,p.intensity]),{radius:80,blur:60,max:1,gradient:{0:'rgba(0,255,0,0.5)',0.5:'rgba(255,255,0,0.6)',0.8:'rgba(255,165,0,0.7)',1:'rgba(255,0,0,0.9)'}});
let heatOn=false;
document.getElementById('toggleHeat').onclick=()=>{heatOn=!heatOn;if(heatOn)heatLayer.addTo(map);else map.removeLayer(heatLayer);}

// --- Survival Tips ---
const tips=["Stay hydrated; water is life.","Avoid high zombie populations at night.","Cities have the best loot but highest risk.","Military areas like airfields are worth the danger."];
setInterval(()=>{document.getElementById("tip").innerText="Survival Tip: "+tips[Math.floor(Math.random()*tips.length)];},12000);
</script>

</body>
</html>
