<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>DayZ Tactical Companion ‚Äì Thermal Enhanced</title>

<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>

<style>
html, body {
  height: 100%; margin: 0; overflow: hidden;
  font-family: system-ui, monospace;
  background-color: #0a0a0a;
  color: #eee;
}
#map { position: absolute; inset: 0; z-index: 1; }

/* Panels */
.panel {
  position: absolute;
  background: rgba(20,20,20,0.4);
  backdrop-filter: blur(6px);
  border-radius: 0.5rem;
  padding: 0.6rem 1rem;
  color: #fff;
  font-size: 0.9rem;
  box-shadow: 0 0 12px rgba(0,0,0,0.5);
  transition: 0.3s all;
}
#info { top: 20px; left: 20px; }
#tip { bottom: 20px; left: 50%; transform: translateX(-50%); }

/* Floating buttons */
.fab-btn {
  position: absolute;
  width: 50px; height: 50px;
  border-radius: 50%;
  border: none;
  background: rgba(255,255,255,0.1);
  color: #ff4444;
  font-size: 1.2rem;
  display: flex;
  justify-content: center;
  align-items: center;
  cursor: pointer;
  backdrop-filter: blur(6px);
  transition: 0.2s all;
  z-index: 1001;
}
.fab-btn:hover { background: rgba(255,255,255,0.2); }
#thermal-btn { top: 20px; right: 20px; }
#marker-btn { top: 80px; right: 20px; }

/* Legend */
#legend {
  position: absolute;
  bottom: 20px; left: 20px;
  display: flex; flex-direction: column; gap: 8px;
  background: rgba(0,0,0,0.3);
  backdrop-filter: blur(6px);
  padding: 0.5rem 0.8rem;
  border-radius: 0.5rem;
  color: #fff;
  z-index: 1000;
}
.legend-item { display: flex; align-items: center; gap: 6px; }
.legend-item img { width: 24px; height: 24px; border-radius: 50%; }

/* Noise overlay */
#noise {
  pointer-events: none;
  position: fixed; inset: 0; z-index: 900;
  opacity: 0.03;
  background: url("data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGZpbHRlciBpZD0ibm9pc2UiPjxmZVR1cmJ1bGVuY2UgdHlwZT0iZnJhY3RhbE5vaXNlIiBiYXNlRnJlcXVlbmN5PSIuNiIgbnVtT2N0YXZlcz0iMSIvPjwvZmlsdGVyPjxyZWN0IHdpZHRoPSI0MCIgaGVpZ2h0PSI0MCIgZmlsdGVyPSJ1cmwoI25vaXNlKSIgb3BhY2l0eT0iLjMiLz48L3N2Zz4=");
}

/* Thermal glow */
.thermal .leaflet-pane.thermal canvas {
    filter: drop-shadow(0 0 12px rgba(255,100,0,0.8))
            drop-shadow(0 0 20px rgba(255,50,0,0.5));
    transition: filter 0.2s ease-in-out;
}
.thermal .leaflet-image-layer { filter: brightness(0.35); }
.leaflet-pane.thermal { z-index: 450; opacity: 0; transition: opacity 0.5s; }
.thermal .leaflet-pane.thermal { opacity: 1; }

</style>
</head>
<body>

<!-- Map -->
<div id="map"></div>
<div id="noise"></div>

<!-- Panels -->
<div id="info" class="panel">Hover military zone</div>
<div id="tip" class="panel">Tip: Stay low.</div>

<!-- Floating Buttons -->
<button id="thermal-btn" class="fab-btn">üå°Ô∏è</button>
<button id="marker-btn" class="fab-btn">üìç</button>

<!-- Legend -->
<div id="legend">
  <div class="legend-item"><img id="lg-mil"> Military</div>
  <div class="legend-item"><img id="lg-exp"> Explorer</div>
  <div class="legend-item"><img id="lg-cau"> Cautious</div>
  <div class="legend-item"><img id="lg-agg"> Aggressive</div>
  <div class="legend-item"><img id="lg-cus"> Custom</div>
  <div style="font-size:.75rem; margin-top:4px;">üî• Heat = activity</div>
</div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script src="https://cdn.jsdelivr.net/npm/leaflet.heat/dist/leaflet-heat.js"></script>

<script>
/* ===== CONFIG ===== */
const CFG={ W:1500,H:1450, MAX:90, HEAT_PUSH:500, KILL_DIST:900, BODY_COOL:0.995 };

/* ===== ICONS ===== */
const svg={mil:`<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32"><path d="M16 0l16 6v16c0 16-11 24-16 24S0 38 0 22V6L16 0z" fill="#ff4444" stroke="#000" stroke-width="2"/><circle cx="16" cy="10" r="6" fill="#fff"/></svg>`,
exp:`<svg xmlns="http://www.w3.org/2000/svg" width="22" height="22"><circle cx="11" cy="11" r="10" fill="#ffcc00" stroke="#000" stroke-width="2"/></svg>`,
cau:`<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18"><circle cx="9" cy="9" r="8" fill="#3399ff" stroke="#000" stroke-width="2"/></svg>`,
agg:`<svg xmlns="http://www.w3.org/2000/svg" width="26" height="26"><circle cx="13" cy="13" r="12" fill="#ff4444" stroke="#000" stroke-width="2"/></svg>`,
cus:`<svg xmlns="http://www.w3.org/2000/svg" width="28" height="28"><path fill="#ff8800" d="M14 2C9 2 5 6 5 10c0 6 9 15 9 15s9-9 9-15c0-4-4-8-9-8z"/></svg>`};
const url=s=>"data:image/svg+xml;base64,"+btoa(s);

/* ===== MAP ===== */
const map=L.map("map",{crs:L.CRS.Simple,minZoom:-2,maxZoom:6});
L.imageOverlay("chernarus.png",[[0,0],[CFG.H,CFG.W]]).addTo(map);
map.fitBounds([[0,0],[CFG.H,CFG.W]]);
const px=(x,y)=>[y,x];
map.createPane("thermal");

/* ===== ICONS ===== */
const icons={mil:L.icon({iconUrl:url(svg.mil),iconSize:[32,32],iconAnchor:[16,32]}),
exp:L.icon({iconUrl:url(svg.exp),iconSize:[22,22],iconAnchor:[11,22]}),
cau:L.icon({iconUrl:url(svg.cau),iconSize:[18,18],iconAnchor:[9,18]}),
agg:L.icon({iconUrl:url(svg.agg),iconSize:[26,26],iconAnchor:[13,26]}),
cus:L.icon({iconUrl:url(svg.cus),iconSize:[28,28],iconAnchor:[14,28]})};
["mil","exp","cau","agg","cus"].forEach(k=>document.getElementById("lg-"+k).src=url(svg[k]));

/* ===== LAYERS ===== */
const milLayer=L.layerGroup().addTo(map);
const plyLayer=L.layerGroup().addTo(map);
const cusLayer=L.layerGroup().addTo(map);

/* ===== HEATMAP (thermal) ===== */
const heat=L.heatLayer([],{
  radius: 80,
  blur: 45,
  max: 3,
  pane: "thermal",
  gradient: {0.0:'blue',0.3:'cyan',0.5:'lime',0.7:'yellow',1.0:'red'}
});
let heatBuf=[]; 
setInterval(()=>{if(heatBuf.length){heat.addLatLngs(heatBuf); heatBuf=[];}},CFG.HEAT_PUSH);

/* ===== MILITARY ===== */
const MIL=[{x:214,y:454,n:"Zelenogorsk"},{x:410,y:148,n:"Balota"},{x:152,y:260,n:"Pavlovo"},{x:566,y:734,n:"Stary"},{x:784,y:1388,n:"Kamensk"},{x:1120,y:1280,n:"NEAF"},{x:264,y:1376,n:"Tisy"},{x:372,y:1004,n:"NWAF"},{x:342,y:762,n:"VMC"}];
const risk={};
MIL.forEach(m=>{
  risk[m.n]=0;
  const mk=L.marker(px(m.x,m.y),{icon:icons.mil}).addTo(milLayer);
  mk.on("mouseover",()=>info.innerHTML=`<b>${m.n}</b><br>Activity: ${risk[m.n]}`);
  mk.on("mouseout",()=>info.innerText="Hover military zone");
});

/* ===== PLAYERS ===== */
const players=[]; const types={exp:{spd:.0015},cau:{spd:.001},agg:{spd:.0018}};
function rnd(){return{x:Math.random()*CFG.W,y:Math.random()*CFG.H};}
function spawn(){if(players.length>=CFG.MAX) return; const k=Object.keys(types)[Math.floor(Math.random()*3)]; const t=MIL[Math.floor(Math.random()*MIL.length)]; const s=rnd(); const dot=L.marker(px(s.x,s.y),{icon:icons[k]}).addTo(plyLayer); players.push({dot,type:k,start:s,target:t,step:0,alive:true,heat:1});}
for(let i=0;i<30;i++) spawn();

/* ===== LOOP ===== */
let last=performance.now();
function loop(ts){
  const d=(ts-last)/16.67; last=ts;
  MIL.forEach(m=>risk[m.n]=0);
  players.forEach(p=>{
    const pulse = 0.3 * Math.sin(performance.now() / 300) + 1; // pulsating heat
    if(!p.alive){p.heat*=CFG.BODY_COOL;}else{p.heat=pulse; p.step+=types[p.type].spd*d; if(p.step>=1){p.start=rnd();p.step=0;}}
    const x=p.start.x+(p.target.x-p.start.x)*p.step;
    const y=p.start.y+(p.target.y-p.start.y)*p.step;
    p.dot.setLatLng(px(x,y));
    heatBuf.push([y,x,p.heat]);
    MIL.forEach(m=>{if((x-m.x)**2+(y-m.y)**2<8000) risk[m.n]++;});
    if(p.type==="agg" && p.alive){players.forEach(o=>{if(o!==p && o.alive){const a=p.dot.getLatLng(),b=o.dot.getLatLng();if((a.lat-b.lat)**2+(a.lng-b.lng)**2<CFG.KILL_DIST){o.alive=false;o.heat=1.5;}}});}
  });
  requestAnimationFrame(loop);
}
requestAnimationFrame(loop);

/* ===== UI ===== */
let thermal=false, mark=false;
document.getElementById("thermal-btn").onclick=()=>{thermal=!thermal; document.body.classList.toggle("thermal",thermal); thermal?heat.addTo(map):map.removeLayer(heat);};
document.getElementById("marker-btn").onclick=()=>mark=!mark;
map.on("click",e=>{if(!mark) return; L.marker(e.latlng,{icon:icons.cus}).addTo(cusLayer).bindPopup("Custom Marker");});

/* ===== TIPS ===== */
const tips=["Avoid hotspots.","Bodies stay warm.","Thermal sees movement.","Aggressive players hunt."];
setInterval(()=>tip.innerText="Tip: "+tips[Math.floor(Math.random()*tips.length)],10000);
</script>

</body>
</html>
