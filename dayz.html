<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>DayZ Chernarus Hub</title>

<!-- Bootstrap -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

<!-- Leaflet -->
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>

<!-- Font Awesome -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>

<style>
html,body{
  margin:0;
  padding:0;
  height:100%;
  background:#111;
  overflow:hidden;
}

#map-container{
  position:relative;
  width:100%;
  height:100%;
}

#blur-bg{
  position:absolute;
  inset:0;
  background:url('chernarus.png') center/cover no-repeat;
  filter:blur(25px) brightness(0.35) contrast(1.2);
  transform:scale(1.1);
  z-index:0;
}

#map{
  position:absolute;
  inset:0;
  z-index:10;
}

nav.navbar{
  position:fixed;
  top:0;
  width:100%;
  z-index:9999;
}

.panel{
  position:absolute;
  background:rgba(0,0,0,0.75);
  color:#fff;
  padding:0.8rem;
  border-radius:8px;
  z-index:20;
  font-size:0.9rem;
}

#lore{top:70px;right:10px;max-width:300px;}
#tip{bottom:10px;left:50%;transform:translateX(-50%);}
#loot-panel{top:70px;left:10px;max-width:220px;max-height:70vh;overflow-y:auto;}

.marker-military{
  background:red;
  width:16px;
  height:16px;
  border-radius:50%;
  border:2px solid #fff;
}

.leaflet-container{background:transparent!important;}
</style>
</head>

<body>

<!-- NAVBAR -->
<nav class="navbar navbar-dark bg-dark">
  <div class="container-fluid">
    <span class="navbar-brand">
      <i class="fa-solid fa-skull-crossbones me-2"></i>DayZ Chernarus Hub
    </span>
    <div class="d-flex gap-2">
      <button id="addPin" class="btn btn-danger btn-sm"><i class="fa-solid fa-map-pin"></i> Pin</button>
      <button id="addRoute" class="btn btn-secondary btn-sm"><i class="fa-solid fa-route"></i> Route</button>
      <button id="clearAll" class="btn btn-secondary btn-sm"><i class="fa-solid fa-trash"></i> Clear</button>
      <button id="toggleNight" class="btn btn-secondary btn-sm"><i class="fa-solid fa-moon"></i> Night</button>
      <button id="toggleHeat" class="btn btn-warning btn-sm"><i class="fa-solid fa-fire"></i> Traffic</button>
    </div>
  </div>
</nav>

<!-- MAP -->
<div id="map-container">
  <div id="blur-bg"></div>
  <div id="map"></div>
</div>

<!-- PANELS -->
<div id="lore" class="panel">Hover over a base for info…</div>
<div id="tip" class="panel">Survival Tip: Coastal towns are looted fast!</div>

<div id="loot-panel" class="panel">
  <strong>Loot Filters</strong><br>
  <input type="checkbox" checked> Military <i class="fa-solid fa-crosshairs text-danger"></i>
</div>

<!-- SCRIPTS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script src="https://cdn.jsdelivr.net/npm/leaflet.heat/dist/leaflet-heat.js"></script>

<script>
// ---------------- MAP SETUP ----------------
const MAP_W = 1500;
const MAP_H = 1450;

const map = L.map('map', {
  crs: L.CRS.Simple,
  minZoom: -2,
  maxZoom: 6,
  doubleClickZoom: false
});

const bounds = [[0,0],[MAP_H,MAP_W]];
L.imageOverlay('chernarus.png', bounds).addTo(map);
map.fitBounds(bounds);

const px = (x,y)=>[y,x];

// ---------------- MILITARY BASES ----------------
const militaryBases = [
  { x:175, y:1000, name:"Zelenogorsk", lore:"Top military loot, high risk." },
  { x:420, y:440, name:"NWAF", lore:"North West Airfield — epic loot, extreme danger." }
];

militaryBases.forEach(b=>{
  const m = L.marker(px(b.x,b.y),{
    icon:L.divIcon({className:"marker-military"})
  }).addTo(map);

  m.on("mouseover",()=>lore.innerText=`${b.name}: ${b.lore}`);
  m.on("mouseout",()=>lore.innerText="Hover over a base for info…");
});

// ---------------- PINS & ROUTES ----------------
let pins = JSON.parse(localStorage.getItem("dzPins")||"[]");
let routes = JSON.parse(localStorage.getItem("dzRoutes")||"[]");

let addingPin=false;
let addingRoute=false;
let tempRoute=[];
let tempLine=null;

pins.forEach(p=>{
  L.marker(px(p.x,p.y)).addTo(map).bindPopup(p.name);
});

routes.forEach(r=>{
  L.polyline(r.points.map(pt=>px(pt.x,pt.y)),{
    color:"orange",
    weight:3
  }).addTo(map);
});

addPin.onclick=()=>{
  addingPin=true;
  addingRoute=false;
  alert("Click map to place a pin");
};

addRoute.onclick=()=>{
  addingRoute=true;
  addingPin=false;
  tempRoute=[];
  if(tempLine){map.removeLayer(tempLine);}
  alert("Click points, double-click to save route");
};

clearAll.onclick=()=>{
  if(confirm("Clear all pins and routes?")){
    localStorage.clear();
    location.reload();
  }
};

map.on("click",e=>{
  const point={x:e.latlng.lng,y:e.latlng.lat};

  if(addingPin){
    const name=prompt("Pin name:");
    if(!name)return;
    pins.push({...point,name});
    localStorage.setItem("dzPins",JSON.stringify(pins));
    L.marker(px(point.x,point.y)).addTo(map).bindPopup(name);
  }

  if(addingRoute){
    tempRoute.push(point);
    if(tempLine)map.removeLayer(tempLine);
    tempLine=L.polyline(tempRoute.map(p=>px(p.x,p.y)),{
      color:"orange",weight:3
    }).addTo(map);
  }
});

map.on("dblclick",()=>{
  if(addingRoute && tempRoute.length>1){
    routes.push({points:tempRoute});
    localStorage.setItem("dzRoutes",JSON.stringify(routes));
    addingRoute=false;
    tempRoute=[];
    tempLine=null;
    alert("Route saved!");
  }
});

// ---------------- NIGHT MODE ----------------
let night=false;
toggleNight.onclick=()=>{
  night=!night;
  map-container.style.filter=night?"brightness(0.3) contrast(1.6)":"none";
};

// ---------------- HEATMAP ----------------
const heatLayer=L.heatLayer([
  [1000,175,1],
  [440,420,1]
],{
  radius:80,
  blur:60,
  max:1,
  gradient:{
    0:'rgba(0,255,0,0.5)',
    0.5:'rgba(255,255,0,0.6)',
    0.8:'rgba(255,165,0,0.7)',
    1:'rgba(255,0,0,0.9)'
  }
});

let heatOn=false;
toggleHeat.onclick=()=>{
  heatOn=!heatOn;
  heatOn?heatLayer.addTo(map):map.removeLayer(heatLayer);
};

// ---------------- TIPS ----------------
const tips=[
  "Stay hydrated — water is life.",
  "Avoid airfields unless geared.",
  "Cities mean loot… and death.",
  "Military zones are never empty."
];

setInterval(()=>{
  tip.innerText="Survival Tip: "+tips[Math.floor(Math.random()*tips.length)];
},12000);
</script>

</body>
</html>
