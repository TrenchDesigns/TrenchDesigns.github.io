<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>RZTA 2398 Map</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">

<style>
html,body{
    margin:0;padding:0;width:100%;height:100%;
    overflow:hidden;background:#111;color:#fff;
    font-family:'Segoe UI',Roboto,sans-serif;
}
.navbar-glass{
    backdrop-filter:blur(18px) saturate(180%);
    background:rgba(20,20,20,.65);
    border-bottom:2px solid #88ff00;
    padding:.45rem 1rem;
    box-shadow:0 10px 25px rgba(0,0,0,.5);
}
.navbar-brand{font-weight:800;color:#88ff00;}
#viewport{
    position:relative;
    width:100%;
    height:calc(100vh - 110px);
    touch-action:none;
    user-select:none;
}
#legend{
    position:absolute;
    top:90px;
    left:12px;
    z-index:500;
    display:flex;
    flex-direction:column;
    gap:6px;
}
.legend-badge{
    font-size:.72rem;
    padding:.35em .6em;
    border-radius:.45rem;
}
#tooltip{
    position:absolute;
    background:rgba(0,0,0,.85);
    padding:6px 10px;
    border-radius:10px;
    font-size:12px;
    display:none;
    pointer-events:none;
    z-index:3000;
}
#coordHud{
    position:absolute;
    bottom:15px;
    left:50%;
    transform:translateX(-50%);
    background:rgba(0,0,0,.9);
    padding:8px 14px;
    border-radius:12px;
    font-size:13px;
    display:none;
    z-index:4000;
    color:#88ff00;
}
footer{
    position:sticky;
    bottom:0;
    width:100%;
    padding:.35rem;
    font-size:.72rem;
    background:rgba(20,20,20,.65);
    border-top:2px solid #88ff00;
    color:#88ff00;
    text-align:center;
}
canvas{display:block;position:absolute;top:0;left:0;}
</style>
</head>

<body>

<nav class="navbar navbar-glass d-flex justify-content-between align-items-center">
    <span class="navbar-brand">
        <i class="fa-solid fa-map"></i> RZTA 2398 Map
    </span>
    <div class="d-flex gap-2 align-items-center">
        <input id="searchBox" class="form-control form-control-sm" placeholder="Search POIâ€¦">
        <button class="btn btn-success btn-sm" id="toggle-thermal">
            <i class="fa-solid fa-fire"></i>
        </button>
        <button class="btn btn-warning btn-sm" id="toggle-picker">
            <i class="fa-solid fa-crosshairs"></i>
        </button>
    </div>
</nav>

<div id="viewport">
    <canvas id="mapCanvas" width="1500" height="1356"></canvas>
    <canvas id="thermalCanvas" width="1500" height="1356" style="display:none;"></canvas>
    <div id="legend"></div>
    <div id="tooltip"></div>
    <div id="coordHud">
        X: <span id="cx"></span> | Y: <span id="cy"></span>
        <span style="opacity:.7;font-size:11px;margin-left:6px;">copied</span>
    </div>
</div>

<footer>RZTA 2398 Map</footer>

<script>
// ===== DATA =====
const locations=[
  {n:'Balota',x:453,y:1188,t:'Village'},
  {n:'Balota Airfield',x:479,y:1197,t:'Airfield'},
  {n:'Berezino',x:1149,y:536,t:'City'},
  {n:'Chernogorsk',x:621,y:1176,t:'City'},
  {n:'Elektrozavodsk',x:971,y:1224,t:'City'},
  {n:'Northwest Airfield (NWAF)',x:418,y:453,t:'Airfield'},
  {n:'Tisy Military Base',x:157,y:139,t:'Military'},
  {n:'Zelenogorsk',x:263,y:934,t:'City'}
];

const colors={
    City:'#1e90ff',
    Town:'#00ffff',
    Village:'#00ff66',
    Military:'#ff3333',
    Airfield:'#ffa500'
};

const hotspotWeights={
    'Northwest Airfield (NWAF)':5,
    'Tisy Military Base':5,
    'Balota Airfield':4,
    'Chernogorsk':4,
    'Elektrozavodsk':4
};

// ===== ELEMENTS =====
const viewport=document.getElementById('viewport');
const mapCanvas=document.getElementById('mapCanvas');
const thermalCanvas=document.getElementById('thermalCanvas');
const mapCtx=mapCanvas.getContext('2d');
const thermalCtx=thermalCanvas.getContext('2d');
const tooltip=document.getElementById('tooltip');
const coordHud=document.getElementById('coordHud');
const cx=document.getElementById('cx');
const cy=document.getElementById('cy');

// ===== STATE =====
let scale=1,translateX=0,translateY=0;
let dragging=false,lastX=0,lastY=0;
let thermalOn=false;
let pickerOn=false;

// ===== LEGEND =====
const legend=document.getElementById('legend');
Object.entries(colors).forEach(([k,v])=>{
    const s=document.createElement('span');
    s.className='badge legend-badge';
    s.style.background=v;
    s.textContent=k;
    legend.appendChild(s);
});

// ===== MAP IMAGE =====
const mapImg=new Image();
mapImg.src='CHERNOMAP.webp';
mapImg.onload=()=>draw();

// ===== DRAW =====
function draw(){
    mapCtx.clearRect(0,0,mapCanvas.width,mapCanvas.height);
    mapCtx.save();
    mapCtx.translate(translateX,translateY);
    mapCtx.scale(scale,scale);
    mapCtx.drawImage(mapImg,0,0,mapCanvas.width,mapCanvas.height);
    locations.forEach(l=>{
        mapCtx.beginPath();
        mapCtx.fillStyle=colors[l.t];
        mapCtx.arc(l.x,l.y,10,0,Math.PI*2);
        mapCtx.fill();
    });
    mapCtx.restore();
    if(thermalOn) drawThermal();
}

// ===== THERMAL =====
function drawThermal(){
    thermalCtx.clearRect(0,0,thermalCanvas.width,thermalCanvas.height);
    thermalCtx.save();
    thermalCtx.translate(translateX,translateY);
    thermalCtx.scale(scale,scale);
    locations.forEach(l=>{
        const w=hotspotWeights[l.n]||1;
        const r=50+20*w;
        const a=.1+.1*w;
        const g=thermalCtx.createRadialGradient(l.x,l.y,0,l.x,l.y,r);
        g.addColorStop(0,`rgba(255,0,0,${a})`);
        g.addColorStop(1,'rgba(255,0,0,0)');
        thermalCtx.fillStyle=g;
        thermalCtx.fillRect(l.x-r,l.y-r,r*2,r*2);
    });
    thermalCtx.restore();
}

// ===== HELPERS =====
function screenToMap(x,y){
    return {x:(x-translateX)/scale,y:(y-translateY)/scale};
}

// ===== TOOLTIP =====
viewport.addEventListener('mousemove',e=>{
    const m=screenToMap(e.offsetX,e.offsetY);
    const hit=locations.find(l=>Math.hypot(l.x-m.x,l.y-m.y)<12);
    if(hit){
        tooltip.style.display='block';
        tooltip.style.left=e.clientX+12+'px';
        tooltip.style.top=e.clientY+12+'px';
        tooltip.innerHTML=`<strong>${hit.n}</strong><br>${hit.t}`;
    } else tooltip.style.display='none';
});

// ===== PICKER =====
document.getElementById('toggle-picker').onclick=()=>{
    pickerOn=!pickerOn;
};

viewport.addEventListener('click',e=>{
    if(!pickerOn) return;
    const rect=viewport.getBoundingClientRect();
    const m=screenToMap(e.clientX-rect.left,e.clientY-rect.top);
    const x=Math.round(m.x);
    const y=Math.round(m.y);
    cx.textContent=x;
    cy.textContent=y;
    coordHud.style.display='block';
    navigator.clipboard.writeText(
        `{ n:'NEW LOCATION', x:${x}, y:${y}, t:'Village' },`
    );
    setTimeout(()=>coordHud.style.display='none',1400);
});

// ===== DRAG =====
viewport.addEventListener('mousedown',e=>{
    dragging=true;
    lastX=e.clientX;
    lastY=e.clientY;
});
window.addEventListener('mouseup',()=>dragging=false);
window.addEventListener('mousemove',e=>{
    if(!dragging) return;
    translateX+=e.clientX-lastX;
    translateY+=e.clientY-lastY;
    lastX=e.clientX;
    lastY=e.clientY;
    draw();
});

// ===== ZOOM =====
viewport.addEventListener('wheel',e=>{
    e.preventDefault();
    const rect=viewport.getBoundingClientRect();
    const cx=e.clientX-rect.left;
    const cy=e.clientY-rect.top;
    const prev=scale;
    scale*=e.deltaY<0?1.12:0.88;
    scale=Math.min(4,Math.max(.5,scale));
    translateX-=(cx-translateX)*(scale/prev-1);
    translateY-=(cy-translateY)*(scale/prev-1);
    draw();
},{passive:false});

// ===== SEARCH =====
document.getElementById('searchBox').addEventListener('keydown',e=>{
    if(e.key!=='Enter') return;
    const q=e.target.value.toLowerCase();
    const l=locations.find(l=>l.n.toLowerCase().includes(q));
    if(!l) return;
    scale=2.5;
    translateX=viewport.clientWidth/2-l.x*scale;
    translateY=viewport.clientHeight/2-l.y*scale;
    draw();
});

// ===== THERMAL TOGGLE =====
document.getElementById('toggle-thermal').onclick=()=>{
    thermalOn=!thermalOn;
    thermalCanvas.style.display=thermalOn?'block':'none';
    draw();
};

// ===== CENTER =====
function centerMap(){
    scale=1;
    translateX=(viewport.clientWidth-mapCanvas.width)/2;
    translateY=(viewport.clientHeight-mapCanvas.height)/2;
    draw();
}
window.addEventListener('resize',centerMap);
centerMap();
</script>

</body>
</html>
