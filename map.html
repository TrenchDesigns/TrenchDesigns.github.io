<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

<title>RZTA 2398 Map</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">

<style>
html,body{
    margin:0;
    padding:0;
    width:100%;
    height:100%;
    background:#111;
    color:#fff;
    overflow:hidden;
    font-family:'Segoe UI',Roboto,sans-serif;
}

/* Layout */
body{
    display:flex;
    flex-direction:column;
}

.navbar-glass{
    backdrop-filter:blur(18px) saturate(180%);
    background:rgba(20,20,20,.7);
    border-bottom:2px solid #88ff00;
    padding:.5rem 1rem;
}

.navbar-brand{
    font-weight:800;
    color:#88ff00;
}

#viewport{
    flex:1;
    position:relative;
    background:#000;
    touch-action:none; /* CRITICAL */
}

canvas{
    position:absolute;
    top:0;
    left:0;
}

/* HUD */
#coordHud{
    position:absolute;
    bottom:14px;
    left:50%;
    transform:translateX(-50%);
    background:rgba(0,0,0,.9);
    padding:8px 16px;
    border-radius:12px;
    font-size:13px;
    color:#88ff00;
    display:none;
    z-index:5000;
}

footer{
    background:rgba(20,20,20,.7);
    border-top:2px solid #88ff00;
    color:#88ff00;
    font-size:.75rem;
    padding:.35rem;
    text-align:center;
}
</style>
</head>

<body>

<nav class="navbar navbar-glass d-flex justify-content-between align-items-center">
    <span class="navbar-brand">
        <i class="fa-solid fa-map"></i> RZTA 2398 Map
    </span>
    <button class="btn btn-warning btn-sm" id="togglePicker">
        <i class="fa-solid fa-crosshairs"></i>
    </button>
</nav>

<div id="viewport">
    <canvas id="mapCanvas"></canvas>

    <div id="coordHud">
        X: <span id="cx"></span> | Y: <span id="cy"></span>
        <span style="opacity:.6;font-size:11px;margin-left:6px;">copied</span>
    </div>
</div>

<footer>RZTA 2398 Custom DayZ Map</footer>

<script>
// ================== CONFIG ==================
const MAP_IMAGE = 'CHERNOMAP.webp'; // exact pixel map
const INITIAL_SCALE = 1;

// Example locations
const locations = [
  { n:'NWAF', x:418, y:453, t:'Airfield' },
  { n:'Tisy', x:157, y:139, t:'Military' }
];

const colors = {
  Airfield:'#ffa500',
  Military:'#ff3333'
};

// ================== ELEMENTS ==================
const viewport = document.getElementById('viewport');
const canvas = document.getElementById('mapCanvas');
const ctx = canvas.getContext('2d');
const coordHud = document.getElementById('coordHud');
const cx = document.getElementById('cx');
const cy = document.getElementById('cy');
const pickerBtn = document.getElementById('togglePicker');

// ================== STATE ==================
let scale = INITIAL_SCALE;
let tx = 0, ty = 0;
let dragging = false;
let pickerOn = false;
let lastX = 0, lastY = 0;

// ================== LOAD MAP ==================
const img = new Image();
img.src = MAP_IMAGE;

img.onload = () => {
    canvas.width = img.width;
    canvas.height = img.height;
    centerMap();
};

// ================== DRAW ==================
function draw(){
    ctx.setTransform(1,0,0,1,0,0);
    ctx.clearRect(0,0,canvas.width,canvas.height);

    ctx.setTransform(scale,0,0,scale,tx,ty);
    ctx.drawImage(img,0,0);

    locations.forEach(l=>{
        ctx.beginPath();
        ctx.fillStyle = colors[l.t] || '#fff';
        ctx.arc(l.x, l.y, 10, 0, Math.PI*2);
        ctx.fill();
    });
}

// ================== HELPERS ==================
function screenToMap(x,y){
    return {
        x: (x - tx) / scale,
        y: (y - ty) / scale
    };
}

function centerMap(){
    scale = INITIAL_SCALE;
    tx = (viewport.clientWidth - canvas.width) / 2;
    ty = (viewport.clientHeight - canvas.height) / 2;
    draw();
}

// ================== PICKER ==================
pickerBtn.onclick = () => {
    pickerOn = !pickerOn;
    pickerBtn.classList.toggle('btn-danger', pickerOn);
};

// ================== POINTER EVENTS ==================
viewport.addEventListener('pointerdown', e => {
    viewport.setPointerCapture(e.pointerId);

    if (!pickerOn) {
        dragging = true;
        lastX = e.clientX;
        lastY = e.clientY;
    }
});

viewport.addEventListener('pointermove', e => {
    if (!dragging || pickerOn) return;

    tx += e.clientX - lastX;
    ty += e.clientY - lastY;
    lastX = e.clientX;
    lastY = e.clientY;
    draw();
});

viewport.addEventListener('pointerup', e => {
    dragging = false;

    if (!pickerOn) return;

    const rect = viewport.getBoundingClientRect();
    const map = screenToMap(
        e.clientX - rect.left,
        e.clientY - rect.top
    );

    const x = Math.round(map.x);
    const y = Math.round(map.y);

    cx.textContent = x;
    cy.textContent = y;
    coordHud.style.display = 'block';

    navigator.clipboard.writeText(
        `{ n:'NEW LOCATION', x:${x}, y:${y}, t:'Village' },`
    );

    setTimeout(()=>coordHud.style.display='none',1500);
});

// ================== ZOOM (OPTIONAL) ==================
viewport.addEventListener('wheel', e => {
    e.preventDefault();
    const zoom = e.deltaY < 0 ? 1.1 : 0.9;
    scale = Math.min(Math.max(scale * zoom, 0.5), 3);
    draw();
}, { passive:false });

// ================== RESIZE ==================
window.addEventListener('resize', centerMap);
</script>

</body>
</html>
