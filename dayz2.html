<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>DayZ Tactical Companion â€“ Chernarus</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>

<style>
html, body {margin:0; height:100%; overflow:hidden; background:#111; font-family:system-ui, monospace;}
#map {position:absolute; inset:0;}
.navbar {z-index:1000; background:#1c1c1c !important; border-bottom:1px solid #333; box-shadow:0 2px 8px rgba(0,0,0,0.5);}
.panel {
  position:absolute; background:rgba(30,30,30,0.95); color:#fff; border:1px solid #555;
  padding:10px 14px; border-radius:6px; font-size:14px; z-index:500; text-shadow:0 0 4px #000;
}
#info {top:70px; right:12px; max-width:280px;}
#tip {bottom:10px; left:50%; transform:translateX(-50%); min-width:260px; text-align:center;}
.marker-military {
  width:16px; height:16px; background:#ff4444; border:2px solid #fff; border-radius:50%;
  box-shadow:0 0 12px #ff6666,0 0 24px rgba(255,0,0,0.6);
}
.player-dot {
  width:5px; height:5px; border-radius:50%; background:#ffcc00; box-shadow:0 0 10px rgba(255,200,50,0.9); transition: transform 0.1s linear;
}
.group-dot {
  width:5px; height:5px; border-radius:50%; background:#ff5555; box-shadow:0 0 12px rgba(255,80,80,1);
}
.thermal-overlay {
  pointer-events:none; position:absolute; inset:0;
  background:rgba(255,50,50,0.12); z-index:400; mix-blend-mode:overlay;
}
</style>
</head>
<body>

<nav class="navbar navbar-dark px-3">
  <span class="navbar-brand small"><i class="fa-solid fa-skull-crossbones me-2"></i>DayZ Tactical Companion</span>
  <div class="ms-auto d-flex gap-2">
    <button id="toggleThermal" class="btn btn-sm btn-outline-danger"><i class="fa-solid fa-fire"></i> Thermal</button>
    <button id="toggleCoordGrab" class="btn btn-sm btn-outline-info"><i class="fa-solid fa-crosshairs"></i> Grab Coord</button>
  </div>
</nav>

<div id="map"></div>
<div class="thermal-overlay" id="thermalOverlay" style="display:none;"></div>
<div id="info" class="panel">Hover a military location</div>
<div id="tip" class="panel">Survival Tip: Always check rooftops for loot.</div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script src="https://cdn.jsdelivr.net/npm/leaflet.heat/dist/leaflet-heat.js"></script>

<script>
// --- MAP ---
const MAP_W=1500, MAP_H=1450;
const map = L.map('map', {crs:L.CRS.Simple, minZoom:-2, maxZoom:6});
const bounds=[[0,0],[MAP_H,MAP_W]];
L.imageOverlay('chernarus.png', bounds).addTo(map);
map.fitBounds(bounds);
const px = (x,y) => [y,x];

// --- MILITARY HOTSPOTS ---
const MILITARY = [
  {x:214,y:454,name:"Zelenogorsk"},
  {x:410,y:148,name:"Balota"},
  {x:152,y:260,name:"Pavlovo"},
  {x:566,y:734,name:"Stary"},
  {x:784,y:1388,name:"Kamensk"},
  {x:1120,y:1280,name:"NEAF"},
  {x:264,y:1376,name:"Tisy"}
];
const risk = {};
MILITARY.forEach(m=>{
  risk[m.name]=0;
  const mk=L.marker(px(m.x,m.y), {icon:L.divIcon({className:"marker-military"})}).addTo(map);
  mk.on("mouseover", ()=>{info.innerHTML=`<strong>${m.name}</strong><br>Activity: ${risk[m.name].toFixed(1)}`;});
  mk.on("mouseout", ()=>{info.innerText="Hover a military location";});
});

// --- HEATMAP ---
const heat = L.heatLayer([], {radius:90, blur:50, max:3,
  gradient:{0:'transparent',0.4:'#0033ff',0.6:'#00ff66',0.75:'#ffff00',0.9:'#ff6600',1:'#ff0000'}
});

// --- SPAWN ZONES (REALISTIC DAYZ WEIGHTS) ---
const SPAWN_ZONES = [
  {x:850, y:250, weight:0.15},   // Cherno
  {x:600, y:400, weight:0.12},   // Electro
  {x:1120,y:1280, weight:0.10},  // NEAF
  {x:214, y:454, weight:0.08},   // Zelenogorsk
  {x:410, y:148, weight:0.07},   // Balota
  {x:784, y:1388, weight:0.06},  // Kamensk
  {x:264, y:1376, weight:0.06},  // Tisy
  {x:400, y:700, weight:0.05},   // Pavlovo
  {x:750, y:750, weight:0.05},   // Stary
  {x:MAP_W/2, y:MAP_H/2, weight:0.06} // central roaming
];

function weightedRandomSpawn() {
  const total = SPAWN_ZONES.reduce((a,z)=>a+z.weight,0);
  let r = Math.random()*total;
  for (let z of SPAWN_ZONES) {
    if(r < z.weight) return {x:z.x + (Math.random()*120-60), y:z.y + (Math.random()*120-60)};
    r -= z.weight;
  }
  return {x:MAP_W/2 + (Math.random()*200-100), y:MAP_H/2 + (Math.random()*200-100)};
}

// --- WAYPOINT GENERATION ---
function generateWaypoints(target, maxSegments=5){
  const spawn = weightedRandomSpawn();
  const segments = 3 + Math.floor(Math.random()*maxSegments);
  const points = [spawn];

  for(let i=1;i<segments;i++){
    const fraction = i/segments;
    const angle = Math.random()*Math.PI*2;
    points.push({
      x: spawn.x + (target.x-spawn.x)*fraction + Math.cos(angle)*120*Math.random(),
      y: spawn.y + (target.y-spawn.y)*fraction + Math.sin(angle)*120*Math.random()
    });
  }

  // Local wandering after reaching target
  if(Math.random()<0.7){
    const last = points[points.length-1];
    for(let i=0;i<3;i++){
      points.push({
        x: last.x + Math.random()*150-75,
        y: last.y + Math.random()*150-75
      });
    }
  }

  points.push(target);
  return points;
}

// --- PLAYER SPAWN ---
const players=[];
function spawnPlayer(target, isGroup=false){
  const size = isGroup ? 2 + Math.floor(Math.random()*4) : 1;
  const waypoints = generateWaypoints(target);
  for(let i=0;i<size;i++){
    const jitter={x:Math.random()*8-4, y:Math.random()*8-4, phase:Math.random()*Math.PI*2};
    const start = waypoints[0];
    const dot = L.circleMarker(px(start.x+jitter.x, start.y+jitter.y),{
      radius:4, color:isGroup?'#ff5555':'#ffcc00', fillOpacity:1
    }).addTo(map);
    const speed = 0.0005 + Math.random()*0.0012;
    players.push({dot, waypoints, seg:0, step:0, jitter, speed, alive:true});
  }
}

// --- PLAYER MOVEMENT & CONFLICT ---
function movePlayers(){
  players.forEach(p=>{
    if(!p.alive) return;
    if(p.seg >= p.waypoints.length-1) return;
    const from = p.waypoints[p.seg];
    const to = p.waypoints[p.seg+1];
    const x = from.x + (to.x-from.x)*p.step + Math.sin(p.jitter.phase)*p.jitter.x;
    const y = from.y + (to.y-from.y)*p.step + Math.cos(p.jitter.phase)*p.jitter.y;
    p.dot.setLatLng(px(x,y));
    heat.addLatLng([y,x,0.25]);
    MILITARY.forEach(m=>{if(Math.hypot(m.x-x,m.y-y)<220) risk[m.name]+=0.01;});
    p.step+=p.speed; 
    p.jitter.phase+=0.03;

    // Conflict deletion
    players.forEach(other=>{
      if(other===p || !other.alive) return;
      const posOther = other.waypoints[Math.min(other.seg,other.waypoints.length-1)];
      if(Math.hypot(posOther.x-x,posOther.y-y)<10 && Math.random()<0.02){
        other.alive=false;
        map.removeLayer(other.dot);
      }
    });

    if(p.seg >= p.waypoints.length-1 && Math.random()<0.6){
      const last = p.waypoints[p.waypoints.length-1];
      for(let i=0;i<3;i++){
        p.waypoints.push({
          x: last.x + Math.random()*120-60,
          y: last.y + Math.random()*120-60
        });
      }
      p.seg=0; p.step=0;
    }

    if(p.step>=1){p.step=0; p.seg++;}
  });
  requestAnimationFrame(movePlayers);
}
requestAnimationFrame(movePlayers);

// --- INITIAL SPAWN ---
MILITARY.forEach(h=>spawnPlayer(h, Math.random()<0.4));
for(let i=0;i<20;i++) spawnPlayer(MILITARY[Math.floor(Math.random()*MILITARY.length)], Math.random()<0.3);

// --- POPULATION MAINTENANCE ---
setInterval(()=>{
  const activePlayers = players.filter(p=>p.alive).length;
  if(activePlayers<10) spawnPlayer(MILITARY[Math.floor(Math.random()*MILITARY.length)], Math.random()<0.5);
  else if(activePlayers<50 && Math.random()<0.3) spawnPlayer(MILITARY[Math.floor(Math.random()*MILITARY.length)], Math.random()<0.35);
},10000);

// --- RISK DECAY ---
setInterval(()=>{Object.keys(risk).forEach(k=>risk[k]=Math.max(0,risk[k]-0.03));},3000);

// --- SURVIVAL TIPS ---
const tips=[
  "Stay hydrated; water is life.",
  "Avoid high zombie populations at night.",
  "Cities have best loot but highest risk.",
  "Military areas are worth the danger.",
  "Check rooftops for rare loot spawns.",
  "Use bushes and tall grass to hide from snipers.",
  "Always carry a melee weapon for stealth kills.",
  "Be careful near airfields, player ambush hotspots.",
  "Use vehicles sparingly; noise attracts attention.",
  "Night travel is risky but less populated."
];
setInterval(()=>{tip.innerText="Survival Tip: "+tips[Math.floor(Math.random()*tips.length)];},12000);

// --- THERMAL TOGGLE ---
let thermal=false;
toggleThermal.onclick=()=>{
  thermal=!thermal;
  thermal?heat.addTo(map):map.removeLayer(heat);
  document.getElementById("thermalOverlay").style.display=thermal?"block":"none";
};

// --- COORDINATE GRAB TOOL ---
let coordGrabActive = false;
const coordMarkers = [];

toggleCoordGrab.onclick = () => {
  coordGrabActive = !coordGrabActive;
  toggleCoordGrab.classList.toggle('active', coordGrabActive);
  map.getContainer().style.cursor = coordGrabActive ? 'crosshair' : '';
  if (!coordGrabActive) {
    coordMarkers.forEach(m => map.removeLayer(m));
    coordMarkers.length = 0;
  }
};

map.on('click', function(e){
  if(!coordGrabActive) return;
  const x = e.latlng.lng.toFixed(0);
  const y = e.latlng.lat.toFixed(0);
  const name = prompt("Enter name for this location:", "NEW_MARKER") || "NEW_MARKER";
  console.log(`Marker coordinates: {x:${x}, y:${y}, name:"${name}"}`);
  const mk = L.circleMarker([y,x], {radius:6, color:'lime'}).addTo(map);
  mk.bindPopup(`<strong>${name}</strong><br>x:${x}, y:${y}`).openPopup();
  coordMarkers.push(mk);
});
</script>
</body>
</html>
