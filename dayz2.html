<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CHERNOMAP – Full Calibration</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
body {
    margin: 0;
    font-family: 'Segoe UI', Arial, sans-serif;
    background: #111;
    color: #fff;
    overflow-x: hidden;
}

.navbar-custom {
    background: rgba(30, 30, 30, 0.7);
    backdrop-filter: blur(12px);
    box-shadow: 0 0 15px rgba(0,0,0,0.5);
}

#map-wrapper {
    position: relative;
    width: 1500px;
    height: 1356px;
    margin: 20px auto;
    border: 2px solid #fff;
    overflow: hidden;
    cursor: crosshair;
}

#map-container {
    position: absolute;
    top: 0;
    left: 0;
    width: 1500px;
    height: 1356px;
    background: url('CHERNOMAP.webp') no-repeat top left;
    background-size: cover;
    transform-origin: center center;
}

.cross-x, .cross-y {
    position: absolute;
    pointer-events: none;
    background: rgba(255,255,255,0.35);
    z-index: 5;
}
.cross-x { height: 1px; width: 100%; }
.cross-y { width: 1px; height: 100%; }

.pin {
    position: absolute;
    width: 10px;
    height: 10px;
    background: red;
    border-radius: 50%;
    transform: translate(-50%, -50%);
    pointer-events: none;
    z-index: 10;
}

#panel {
    width: 520px;
    margin: 15px auto;
    background: rgba(26,26,26,0.75);
    backdrop-filter: blur(12px);
    border: 1px solid #444;
    padding: 12px;
    border-radius: 15px;
}

#panel h2 {
    text-align: center;
    margin: 0 0 8px 0;
}

#instruction, #progress, #coords {
    text-align: center;
    margin-bottom: 6px;
}

#coords {
    font-family: monospace;
}

button {
    padding: 6px 10px;
    margin: 4px;
    cursor: pointer;
}

textarea {
    width: 100%;
    height: 260px;
    background: #000;
    color: #0f0;
    font-family: monospace;
    margin-top: 8px;
    border-radius: 8px;
    padding: 6px;
}

/* Thermal canvas */
#heatmap-canvas {
    position: absolute;
    top: 0;
    left: 0;
    width: 1500px;
    height: 1356px;
    pointer-events: none;
    z-index: 8;
}
</style>
</head>

<body>

<nav class="navbar navbar-expand-lg navbar-dark navbar-custom">
  <div class="container-fluid">
    <a class="navbar-brand" href="#">CHERNOMAP</a>
    <button class="btn btn-outline-light" id="toggleHeat">Toggle Thermal Mode</button>
  </div>
</nav>

<div id="map-wrapper">
    <canvas id="heatmap-canvas"></canvas>
    <div id="map-container">
        <div class="cross-x" id="crossX"></div>
        <div class="cross-y" id="crossY"></div>
    </div>
</div>

<div id="panel">
    <h2>Calibration Panel</h2>
    <div id="progress">Idle</div>
    <div id="instruction">Press Start</div>
    <div id="coords">X: — | Y: —</div>

    <button class="btn btn-primary" id="start">Start</button>
    <button class="btn btn-warning" id="undo" disabled>Undo</button>
    <button class="btn btn-success" id="copy" disabled>Copy Results</button>

    <textarea id="output" readonly></textarea>
</div>

<script>
/* ===== LOCATIONS ===== */
const locations = [
{n:'Balota',x:453,y:1188},{n:'Balota Airfield',x:479,y:1197},{n:'Berezino',x:1149,y:536},{n:'Bor',x:323,y:1046},
{n:'Chernaya Polyana',x:1179,y:167},{n:'Chernogorsk',x:621,y:1176},{n:'Drozhino',x:328,y:973},{n:'Dubrovka',x:978,y:521},
{n:'Elektrozavodsk',x:971,y:1224},{n:'Gorka',x:899,y:604},{n:'Grishino',x:566,y:473},{n:'Guglovo',x:797,y:796},
{n:'Kabanino',x:502,y:627},{n:'Kalinovka',x:713,y:192},{n:'Kamensk Military',x:737,y:73},{n:'Kamyshovo',x:1121,y:1088},
{n:'Khelm',x:1141,y:409},{n:'Komarovo',x:344,y:1188},{n:'Kozlovka',x:421,y:987},{n:'Krasnostav',x:1036,y:296},
{n:'Krasnostav Airstrip',x:1132,y:266},{n:'Lopatino',x:268,y:506},{n:'Mogilevka',x:717,y:944},{n:'Msta',x:1064,y:909},
{n:'Myshkino',x:212,y:744},{n:'Myshkino Tents',x:122,y:748},{n:'Nadezhdino',x:559,y:977},{n:'Northwest Airfield (NWAF)',x:418,y:453},
{n:'Novaya Petrovka',x:323,y:222},{n:'Novodmitrovsk',x:1076,y:112},{n:'Novy Sobor',x:673,y:713},{n:'Orlovets',x:1127,y:743},
{n:'Pavlovo',x:179,y:1077},{n:'Pavlovo Military',x:213,y:1104},{n:'Polana',x:997,y:651},{n:'Prigorodki',x:698,y:1116},
{n:'Pulkovo',x:467,y:898},{n:'Pusta',x:866,y:1072},{n:'Rogovo',x:452,y:787},{n:'Severograd',x:741,y:261},
{n:'Shakhovka',x:877,y:823},{n:'Sinystok',x:149,y:314},{n:'Solnichniy',x:1232,y:833},{n:'Sosnovka',x:247,y:834},
{n:'Staroye',x:924,y:909},{n:'Stary Sobor',x:587,y:723},{n:'Stary Sobor Military',x:607,y:701},{n:'Svetlojarsk',x:1292,y:211},
{n:'Tisy Military Base',x:157,y:139},{n:'Topolniki',x:287,y:254},{n:'Tulga',x:1196,y:998},{n:'Vybor',x:372,y:603},
{n:'Vyshnoye',x:633,y:862},{n:'Zelenogorsk',x:263,y:934},{n:'Zelenogorsk Military',x:243,y:951},{n:'Zvir',x:62,y:928}
];

/* Hotspot weights for thermal */
const thermalWeights = {
  'Northwest Airfield (NWAF)': 5,
  'Tisy Military Base': 5,
  'Balota Airfield': 4,
  'Chernogorsk': 4,
  'Elektrozavodsk': 4,
  'Zelenogorsk': 3,
  'Stary Sobor': 3,
  'Novy Sobor': 3,
  'Vybor': 3,
  'Berezino': 3
};

/* ===== STATE ===== */
let index=-1, active=false, results=[], pins=[], thermalMode=true;
const map = document.getElementById('map-container');
const crossX = document.getElementById('crossX');
const crossY = document.getElementById('crossY');
const instruction = document.getElementById('instruction');
const progress = document.getElementById('progress');
const coords = document.getElementById('coords');
const output = document.getElementById('output');
const startBtn = document.getElementById('start');
const undoBtn = document.getElementById('undo');
const copyBtn = document.getElementById('copy');
const toggleHeat = document.getElementById('toggleHeat');

const heatCanvas = document.getElementById('heatmap-canvas');
const ctx = heatCanvas.getContext('2d');

/* ===== CROSSHAIR & COORDS ===== */
map.addEventListener('mousemove', e=>{
    const r=map.getBoundingClientRect();
    const x=Math.round(e.clientX - r.left);
    const y=Math.round(e.clientY - r.top);
    crossX.style.top = y+'px';
    crossY.style.left = x+'px';
    coords.textContent = `X: ${x} | Y: ${y}`;
});

/* ===== START CALIBRATION ===== */
startBtn.addEventListener('click', ()=>{
    active=true; index=0; results=[]; output.value=''; pins.forEach(p=>p.remove()); pins=[];
    instruction.textContent=`Click on: ${locations[index].n}`;
    progress.textContent=`1 / ${locations.length}`;
    undoBtn.disabled=false; copyBtn.disabled=true;
});

/* ===== CLICK RECORD ===== */
map.addEventListener('click', e=>{
    if(!active) return;
    const r=map.getBoundingClientRect();
    const x=Math.round(e.clientX - r.left);
    const y=Math.round(e.clientY - r.top);
    const loc=locations[index];
    results.push({name: loc.n,x,y});
    output.value+=`${loc.n}: ${x},${y}\n`;
    const pin=document.createElement('div');
    pin.className='pin'; pin.style.left=x+'px'; pin.style.top=y+'px';
    map.appendChild(pin); pins.push(pin);
    index++;
    if(index<locations.length){
        instruction.textContent=`Click on: ${locations[index].n}`;
        progress.textContent=`${index+1} / ${locations.length}`;
    } else {
        instruction.textContent='Calibration complete ✔';
        progress.textContent=`${locations.length} / ${locations.length}`;
        active=false; copyBtn.disabled=false;
    }
    drawThermal();
});

/* ===== UNDO ===== */
undoBtn.addEventListener('click', ()=>{
    if(results.length===0) return;
    results.pop();
    pins.pop().remove();
    index--;
    output.value = results.map(r=>`${r.name}: ${r.x},${r.y}`).join('\n')+'\n';
    instruction.textContent=`Click on: ${locations[index].n}`;
    progress.textContent=`${index+1} / ${locations.length}`;
    drawThermal();
});

/* ===== COPY RESULTS ===== */
copyBtn.addEventListener('click', ()=>{
    navigator.clipboard.writeText(output.value);
    copyBtn.textContent='Copied!';
    setTimeout(()=>copyBtn.textContent='Copy Results',1500);
});

/* ===== TOGGLE THERMAL ===== */
toggleHeat.addEventListener('click', ()=>{
    thermalMode=!thermalMode;
    drawThermal();
});

/* ===== THERMAL RENDER ===== */
function drawThermal(){
    ctx.clearRect(0,0,heatCanvas.width,heatCanvas.height);
    locations.forEach(l=>{
        const weight = thermalMode ? (thermalWeights[l.n]||1) : 1;
        const radius = 70 * weight;
        const alpha = 0.12 * weight;
        const grad = ctx.createRadialGradient(l.x,l.y,0,l.x,l.y,radius);
        grad.addColorStop(0,'rgba(255,0,0,'+alpha+')');
        grad.addColorStop(1,'rgba(255,0,0,0)');
        ctx.fillStyle=grad;
        ctx.fillRect(l.x-radius,l.y-radius,radius*2,radius*2);
    });
}

/* ===== INIT ===== */
drawThermal();
</script>
</body>
</html>
